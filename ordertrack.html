<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./ordertrack.css">
    <title>SHOPAL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="all-nav">
            <nav class="navbar1">
                <div class="logo-And-Search">
                    <a href="./index.html">
                        <div class="Logo">
                            <img src="./media/Purple_Blue_Yellow_Modern_S_Letter_Company_Logo-removebg-preview 2.png" class="logo" alt="Logo">
                            <p>SHOPAL</p>
                        </div>
                    </a>
                    <div class="Search-input">
                        <img src="./media/Vector search.png" alt="">
                        <input type="text" placeholder="Search for Products" class="search-nav" id="search-nav"/>
                    </div>
                </div>
                <div class="User-Detail-Nav">
                    <div class="location-And-Order">
                        <div class="location-nav">
                            <a href="">
                                <img src="./media/reliance_hmo 1.png" alt="">
                                <p>Uyo</p>
                            </a>
                        </div>
                        <div class="order-nav">
                            <a href="./ordertrack.html">
                                <img src="./media/Vector.png" alt="">
                                <p>Order</p>
                            </a>
                        </div>
                    </div>
                    <div class="Cart-And-Profile-image">
                        
                            <div class="Cart">
                                <a href="./cart.html">
                                    <div class="Cart-adder hidden" id="Cart-adder"></div>
                                    <img src="./media/Frame 1.png" alt="Cart">
                                </a>
                            </div>
                        
                        <div class="Profile-image">
                            <a href="">
                                <img src="" class="profile-image" alt="profile-image">
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
            <hr>
            <nav class="navbar2">
                
                <div class="Categories-navbar">
                        <img src="./media/Storefront.png" alt="">
                        <p>CATEGORIES</p>
                </div>
                <div class="ul-navbar">
                    <ul>
                        <li><a href="./CLOTHINGS.html">CLOTHINGS</a></li>
                        <li><a href="./SHOES.html">SHOES</a></li>
                        <li><a href="./ELECTRONICS.html">ELECTRONICS</a></li>
                        <li><a href="./GADGETS.html">GADGETS</a></li>
                        <li><a href="./JEWELRY.html">JEWELRY</a></li>
                        <li><a href="./BEAUTY.html">BEAUTY</a></li>
                        <li><a href="./HEALTH.html">HEALTH & MEDICALS</a></li>
                    </ul>
                </div>
            </nav>
            <nav class="navbar2-tab">
                
                <div class="Categories-navbar">
                    <img src="./media/Storefront.png" alt="">
                    <p>CATEGORIES</p>
                    <div class="Search-input-tab">
                        <img src="./media/Vector search.png" alt="">
                        <input type="text" placeholder="Search for Products" class="search-nav" id="search-nav"/>
                    </div>
                </div>

                

                <div class="Hamburger-lap">
                    <img src="./media/icons8-hamburger-240.png" class="Hamburger2" alt="Hamburger">
                </div>
            </nav>
            <hr>
        </nav>
        <nav class="mobile-nav">
            <nav class="nav1">
                <div class="logo-And-Search">
                    <a href="./index.html">
                        <div class="Logo">
                            <img src="./media/Purple_Blue_Yellow_Modern_S_Letter_Company_Logo-removebg-preview 2.png" class="logo" alt="Logo">
                            <p>SHOPAL</p>
                        </div>
                    </a>                    
                </div>
                <div class="Hamburger-Cart">
                    <div class="Hamburger">
                        <img src="./media/icons8-hamburger-240.png" class="Hamburger" alt="Hamburger">
                    </div>
                    <div class="Cart">
                        <a href="./cart.html">
                            <div class="Cart-adder hidden" id="Cart-adder"></div>
                            <img src="./media/Frame 1.png" class="cart-img" alt="Cart">
                        </a>
                    </div>
                </div>
            </nav>
            <nav class="nav2">
                <div class="Search-input">
                    <img src="./media/Vector search.png" alt="">
                    <input type="text" placeholder="Search for Products" class="search-nav" id="search-nav"/>
                </div>
            </nav>
        </nav>
        <hr>
        <div class="Cart-adder-message hidden" id="Cart-adder-message">
            
        </div>
        
        <div class="navpop hidden"></div>
    </header>
    <section>
        <main>
            <div class="profile"></div>
            <div class="Track"></div>
            <div class="heading"></div>
            <div class="AllProduct"></div>
            <div class="null">
                <div class="subtotal-containers">
                    <div class="hr"></div>
                    <div class="subtotal-container">
                        <div class="Total"></div>
                        <div class="Proceed-to-Payment"></div>
                    </div>
                    <div class="hr2"></div>
                </div>
            </div>
            
        </main>
    </section>
    <footer>
        <div class="footer">
            <div class="footer-logo">
                <div class="footer-Logo">
                    <img src="./media/Purple_Blue_Yellow_Modern_S_Letter_Company_Logo-removebg-preview 2.png" class="logo" alt="Logo">
                    <p>SHOPAL</p>
                </div>
                <p>Design amazing digital experiences that create more happy in the world.</p>
            </div>
            <div class="footer-details">
                <h4>Product</h4>
                <p>Overview</p>
                <p>Features</p>
                <p>Solutions</p>
                <p>Tutorials</p>
                <p>Pricing</p>
                <p>Releases</p>
            </div>
            <div class="footer-details">
                <h4>Company</h4>
                <p>About us</p>
                <p>Careers</p>
                <p>Press</p>
                <p>News</p>
                <p>Media kit</p>
                <p>Contact</p>
            </div>
            <div class="footer-details">
                <h4>Resources</h4>
                <p>Blog</p>
                <p>Newsletter</p>
                <p>Events</p>
                <p>Help centre</p>
                <p>Tutorials</p>
                <p>Support</p>
            </div>
            <div class="footer-details">
                <h4>Social</h4>
                <p>Twitter</p>
                <p>LinkedIn</p>
                <p>Facebook</p>
                <p>GitHub</p>
                <p>AngelList</p>
                <p>Dribbble</p>
            </div>
            <div class="footer-details">
                <h4>Legal</h4>
                <p>Terms</p>
                <p>Privacy</p>
                <p>Cookies</p>
                <p>Licenses</p>
                <p>Settings</p>
                <p>Contact</p>
            </div>
        </div>
        <div class="footer2">
            <p>&copy; 2027SHOPAL.All rights reserved </p>
            <div class="footer2-img">
                <img src="./media/Social icon.png" alt="">
                <img src="./media/Social icon0.png" alt="">
                <img src="./media/Social icon2.png" alt="">
                <img src="./media/Social icon3.png" alt="">
                <img src="./media/Social icon4.png" alt="">
                <img src="./media/Social icon5.png" alt="">
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const Profile = document.querySelector(".profile")
        const AllProduct = document.querySelector(".AllProduct")
        const CartAdder = document.querySelectorAll(".Cart-adder")
        const CartAdderMessage = document.querySelector(".Cart-adder-message")
        const ProceedtoPayment = document.querySelector(".Proceed-to-Payment")
        const Total = document.querySelector(".Total")
        const hr = document.querySelector(".hr")
        const hrTwo = document.querySelector(".hr2")
        const heading = document.querySelector(".heading")
        const Null = document.querySelector(".null")
        const navpop = document.querySelector(".navpop")
        const hamburger = document.querySelector(".Hamburger")
        const hamburgerLap = document.querySelector(".Hamburger-lap")
        let setcheck = false
        const ProfileImage = document.querySelector(".Profile-image")

        let Cart = JSON.parse(localStorage.getItem("Cart")) || [];
        let itemBought = JSON.parse(localStorage.getItem("itemBought")) || [];

        function saveToLocalStorage(){
            localStorage.setItem("Cart", JSON.stringify(Cart))
            localStorage.setItem("itemBought", JSON.stringify(itemBought))
        }

                
        if (Cart.length > 0) {
            CartAdder.forEach( add => add.innerHTML = `<p>${adder(Cart)}</p>`);
            console.log(Cart)
        }
                
            
        const supabaseUrl = "https://viphpfmfsxvlqxazlqxh.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpcGhwZm1mc3h2bHF4YXpscXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4MDQzNjYsImV4cCI6MjA4MDM4MDM2Nn0.rLwimKfftqlT7ZLh2_npUNq-yfHHbzBTJFiGc1ooCAY";
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey); 

        // const {data: {session}} = await supabaseClient.auth.getSession()

        // let userName;
        // if(session){
        //     const UserName = session.user.user_metadata.fullName;
        //     console.log("User name:", UserName);

        //     userName = UserName
        // }


        async function Check() {
            const {data} = await supabaseClient.auth.getUser()
            if(!data.user){
                console.log(data)
                // alert("log in alaye")
                ProfileImage.innerHTML= `<button class="SignIn">Sign in</button>`
                    
                let SignIn = ProfileImage.querySelector(".SignIn")
                SignIn.addEventListener("click", () => window.location.href = "signin.html")
            }else{

                let userName = data.user.user_metadata.userName
                let email = data.user.user_metadata.email

                Profile.innerHTML = `
                    <div class="customer-profile">
                        <h2>Good day ${userName}, this is your profile</h2>
                        <p>Customer Name: <span>${userName}</span></p>
                        <p>Customer Email: <span>${email}</span></p>
                        
                    </div>
                    
                `

                if(userName.length > 10){
                    userName = userName.slice(0, 3) + "..."
                }


                ProfileImage.innerHTML= `<div class="profile-session">
                    <div class="profile"><div class="Profile">
                        <img src="./media/Profile.png" class="profile-image" alt="profile-image" />
                    </div>
                    <p>${userName}</p>
                    </div>
                    <div class="logout"><div class="logout">
                        <img src="./media/logout.png" class="profile-image" alt="profile-image" />
                    </div>
                    </div>
                </div>`

                let Profiles = ProfileImage.querySelector(".profile")
                Profiles.addEventListener("click", () => {
                    window.location.href = "ordertrack.html";
                })

                let logout = ProfileImage.querySelector(".logout")
                logout.addEventListener("click", async () => {
                    await supabaseClient.auth.signOut();
                    window.location.href = "signin.html";
                })
            }
            
        }

        Check();

        async function Check2(ProfileImage2) {
            const {data} = await supabaseClient.auth.getUser()
            if(!data.user){
                // alert("log in alaye")
                // ProfileImage.innerHTML= `<button class="SignIn">Sign in</button>`
                
                console.log(data)
                ProfileImage2.innerHTML= `<button class="SignIn" >Sign in</button>`
                
                let SignIn = ProfileImage2.querySelector(".SignIn")
                SignIn.addEventListener("click", () => window.location.href = "signin.html")

            }else{

                let userName = data.user.user_metadata.userName || "User"
                if(userName.length > 10){
                    userName = userName.slice(0, 3) + "..."
                }


                ProfileImage2.innerHTML = `<hr />
                <div class="profile-session">
                    <div class="profile"><div class="Profile">
                        <img src="./media/Profile.png" class="profile-image" alt="profile-image" />
                    </div>
                    <p>${userName}</p>
                    </div>
                    <div class="Logout">
                        <div class="logout">
                            <img src="./media/logout.png" class="profile-image" alt="profile-image" />
                        </div>
                        <p>Logout</p>
                    </div>
                </div>`

                let Profile = ProfileImage2.querySelector(".profile")
                Profile.addEventListener("click", () => {
                    window.location.href = "ordertrack.html";
                })

                let logout = ProfileImage2.querySelector(".Logout")
                logout.addEventListener("click", async () => {
                    await supabaseClient.auth.signOut();
                    window.location.href = "signin.html";
                })
            
            }
        }


        function saveToLocalStorage(){
            localStorage.setItem("Cart", JSON.stringify(Cart))
        }

        hamburgerLap.addEventListener("click", () => {
            if(setcheck === false){
                navpop.classList.remove("hidden")
                navpop.innerHTML = `
                    <div class="pop">
                        <div class="ul-navbar">
                            <ul>
                                <li><a href="./CLOTHINGS.html">CLOTHINGS</a></li>
                                <li><a href="./SHOES.html">SHOES</a></li>
                                <li><a href="./ELECTRONICS.html">ELECTRONICS</a></li>
                                <li><a href="./GADGETS.html">GADGETS</a></li>
                                <li><a href="./JEWELRY.html">JEWELRY</a></li>
                                <li><a href="./BEAUTY.html">BEAUTY</a></li>
                                <li><a href="./HEALTH.html">HEALTH & MEDICALS</a></li>
                            </ul>
                        </div>            
                    </div>
                `

            }else{
                navpop.classList.add("hidden")
            }

            setcheck = true
        })

        hamburger.addEventListener("click", () => {
            if(setcheck === false){
                navpop.classList.remove("hidden")
                navpop.innerHTML = `
                    <div class="pop">
                        <div class="location-And-Order">
                            <div class="location-nav">
                                <a href="">
                                    <img src="./media/reliance_hmo 1.png" alt="">
                                    <p>Uyo</p>
                                </a>
                            </div>
                            <div class="order-nav">
                                <a href="./ordertrack.html">
                                    <img src="./media/Vector.png" alt="">
                                    <p>Order</p>
                                </a>
                            </div>
                        </div>
                        <hr/>
                        <div class="ul-navbar">
                            <ul>
                                <li><a href="./CLOTHINGS.html">CLOTHINGS</a></li>
                                <li><a href="./SHOES.html">SHOES</a></li>
                                <li><a href="./ELECTRONICS.html">ELECTRONICS</a></li>
                                <li><a href="./GADGETS.html">GADGETS</a></li>
                                <li><a href="./JEWELRY.html">JEWELRY</a></li>
                                <li><a href="./BEAUTY.html">BEAUTY</a></li>
                                <li><a href="./HEALTH.html">HEALTH & MEDICALS</a></li>
                            </ul>
                        </div>
                        <div class="Profile-image2"></div>
                    
                    </div>
                `

                
                const ProfileImage2 = navpop.querySelector(".Profile-image2")

                Check2(ProfileImage2)

            }else{
                navpop.classList.add("hidden")
            }

            setcheck = true
        })

        navpop.addEventListener("click", () => {
            navpop.classList.add("hidden")
            setcheck = false
        })


        function adder(Cart){
            if (Cart.length > 0){
                CartAdder.forEach(add => add.classList.remove("hidden"))
                let cartShower = Cart.reduce((sum, item) => sum + item.quantity, 0);
                return cartShower;
            }

            saveToLocalStorage()

        }

        DisplayProducts(itemBought)
        if (itemBought.length > 0) {
            DisplayProducts(itemBought)
        }else{
            AllProduct.classList.add("no-cart")
            AllProduct.innerHTML = `
                
                <img src="./mediaspeP/Rectangle 131.png" class="productCard-img2" alt="">
                <p class="sapaa">
                    You have clear order history wereyðŸ˜­ðŸ˜‚. Go to shop to spend your last card and embrace sapaðŸ˜‚ðŸ¤£
                </p>
                <button class="but" onclick="window.location.href='index.html'">Shop Now</button>
            `
            Null.innerHTML = ""
            document.querySelector(".imageP").innerHTML = ""
            
            
        }

        saveToLocalStorage()
        function subtotal(Cart){
            const pTotal = itemBought.map(prod => prod.quantity * prod.price + prod.price/500, 0)
            const Sum = pTotal.reduce((sum, item) => sum + item, 0)
            return Sum.toFixed(2)
        }

        function DisplayProducts(Products){

            if (Products.length === 0) {
                AllProduct.classList.add("no-cart")
                AllProduct.innerHTML = `
                    
                    <img src="./mediaspeP/Rectangle 131.png" class="productCard-img2" alt="">
                    <p class="sapaa">
                        No Product available wereyðŸ˜­ðŸ˜‚. You can check order to view ordered product or go to shop to spend your last card and embrace sapaðŸ˜‚ðŸ¤£
                    </p>
                    <button class="but" onclick="window.location.href='index.html'">Shop Now</button>
                `
                Null.innerHTML = ""
                document.querySelector(".imageP").innerHTML = ""
                CartAdder.classList.add("hidden")
                heading.innerHTML = ""
                return; // STOP here
            }
            
            AllProduct.innerHTML = "";
            Products.map((item, index, arr) => {
                let productCard = document.createElement("div")
                productCard.classList.add("productCard")
                saveToLocalStorage()
                const shippingG = (item.price/500).toFixed(2)
                const TotalPrice = (item.price * item.quantity + item.price/500).toFixed(2)
                productCard.innerHTML = `
                
                <img src="${item.thumbnail}" class="productCard-img" alt="${item.title}">
                <div class="conB">
                    <div class="card-content">
                        <p class="card-p">Product Name: <span class="span1">${item.title}</span></p>
                        <p class="card-p">Product Quantity: <span>${item.quantity}</span></p>
                        <p class="card-p">Product Price: <span class="span3">$${item.price}</span></p>
                        <p class="card-p">Shipping Price: <span class="span4">$${shippingG}</span></p>
                        <p class="card-p">Total Price: <span class="span5">$${TotalPrice}</span></p>
                        
                    </div>
                    <button class="Delete">Delete History</button>
                </div>
                `
                if (itemBought.length > 0) {
                    if (itemBought.length > 1){
                        heading.innerHTML = `<h1>${adder(itemBought)} Item Boughts</h1>`
                    }else{
                        heading.innerHTML = `<h1>${adder(itemBought)} Item Bought</h1>`
                    }


                            
                    ProceedtoPayment.innerHTML = `
                        <button class="checkout">Clear All</button>
                        
                    `
                    Total.innerHTML = `
                    <p class="history-content">You've bought ${adder(itemBought)} products worth ($${(subtotal(Cart))}) in your order history</p>`
                    let checkout = ProceedtoPayment.querySelector(".checkout")
                    checkout.addEventListener("click", () => {
                        itemBought = []; 
                        saveToLocalStorage();
                        window.location.href = `ordertrack.html`
                    })
                    hr.innerHTML = `<hr/>`
                    hrTwo.innerHTML = `<hr/>`
                    // DisplayProducts(Cart)
                }

                function adder(Cart){
                    if (Cart.length > 0){
                        let cartShower = Cart.reduce((sum, item) => sum + item.quantity, 0);
                        return cartShower;
                    }

                }

                saveToLocalStorage()
                AllProduct.appendChild(productCard)

                let Delete = productCard.querySelector(".Delete")
                Delete.addEventListener("click", () => {
                    
                    DeleteEvent(item.title)
                    DisplayProducts(itemBought)
                })
            })

            saveToLocalStorage()

        }
        
        function DeleteEvent(title){
            // let checkProduct = Cart.find(prod => prod.id === pid)
                itemBought = itemBought.filter(prod => prod.title !== title)
                saveToLocalStorage()
                
                DisplayProducts(itemBought)
        }

        
        function addToCart(id, title, price, category, thumbnail, images, rating, description, story){
            let checkProduct = Cart.find(prod => prod.id == id && prod.title == title)
            if (checkProduct){
                checkProduct.quantity++;
                saveToLocalStorage()                
            }
            else{
                Cart.push({ id, title, price, category, thumbnail, images, rating, description, story, quantity: 1})
                saveToLocalStorage()
            }

            saveToLocalStorage()
            
            // CartSubMESSAGE()
        }


        function CartAdderMESSAGE(){
            const CartAdderMessage = document.getElementById("Cart-adder-message")
            CartAdderMessage.innerHTML = `
                <div class="Cart-Adder-Message">
                    <p class="hidden2 message">Product added successfully âœ…. Continue shopping or check your cart to proceed to payment
                    </p>
                </div>
            `;

            saveToLocalStorage()
            
        }

        function cartDecrement(id, title, price, category, thumbnail, images, rating, description, story){
            let checkProduct = Cart.find(prod => prod.id === id)
            if (checkProduct){
                if(checkProduct.quantity > 1){
                    checkProduct.quantity--;
                }
                saveToLocalStorage()                
            }
            else{
                saveToLocalStorage()
            }

            saveToLocalStorage()
            
            CartAdderMessage.classList.remove("hidden")
        }

        function subTractor(Cart){
            if (Cart.length > 0){
                CartAdder.classList.remove("hidden")
                let cartShower = Cart.reduce((sub, item) => sub + item.quantity, 0);
                return cartShower;
            }

            saveToLocalStorage()

        }


        function CartSubMESSAGE(){
            const CartAdderMessage = document.getElementById("Cart-adder-message")
            CartAdderMessage.innerHTML = `
                <div class="Cart-Adder-Message">
                    <p class="hidden2 message">Product added successfully âœ…. Continue shopping or check your cart to proceed to payment
                    </p>
                </div>
            `;

            saveToLocalStorage()
            
        }

        function changeImage(img) {
            document.getElementById("mainImage").src = img
        }

        saveToLocalStorage()

        // function safeCheck(item){
        //     if (item){
        //         showDetail()
        //     }else{
        //         console.log("err")
        //     }
        // }
    </script>
</body>
</html>